\section{逼真渲染和光线追踪算法}\label{sec:逼真渲染和光线追踪算法}

逼真渲染的目标是创建3D场景的图像且与同一场景的照片难以区分。
在我们介绍渲染流程之前要重点理解的是，
此处的{\itshape 难以区分}一词不是精确说法，
因为它涉及人类观察者，
不同观察者对同一图像的感知可能是不同的。
尽管本书会涉及少量感知问题，
但明确给出观察者的精确特性是非常困难且远未解决的问题。
绝大多数时候，我们都对针对光及其与物质相互作用的物理仿真感到满意，
并以我们对显示技术的理解尽可能向观察者展示最好的图像。

几乎所有逼真渲染系统都基于光线追踪算法。
光线追踪算法其实很简单；
它跟随光线\sidenote{译者注：原文a ray of light。
    此外会按个人理解把ray译作“光线”或“射线”，把light译作“光”或“光线”。}路径
穿过场景与环境中的物体相互作用并反射。
虽然编写光线追踪器的方法有很多，
但所有这些系统都必须模拟至少一项以下对象和现象：
\begin{itemize}
    \item \keyindex{相机}{cameras}{camera相机}： 相机模型决定了从哪里、怎样观察场景，
          包括场景的图像是怎样记录到传感器上的。
          许多渲染系统从相机处开始生成视线并追踪到场景中。
    \item \keyindex{光线-物体交点}{ray–object intersections}{ray光线}： 此外，我们需要确定
          交点处物体的特定属性，例如表面法线或材质。
          多数光线追踪器都有测试光线与多个物体相交的功能，
          典型的例如沿光线返回最近交点。
    \item \keyindex{光源}{light sources}{light光}： 没有光，渲染场景就没有意义。
          光线追踪器必须对整个场景的光分布建模，
          不仅包括灯光自身的位置，还包括它们向整个场景发散能量的方式。
    \item \keyindex{可见性}{visibility}{}：为了知道给定光是否在表面上一点积累能量，
          必须确认从该点到光源是否存在一条不中断的路径。
          幸运的是，在光线追踪器中这个问题很容易回答，
          因为我们可以构造从表面到光源\sidenote{译者注：原文为light，我按个人理解译作“光源”。}的射线，
          寻找最近的光线-物体交点，
          并比较交点距离和光源距离。
    \item \keyindex{表面散射}{surface scattering}{}：每个物体都必须提供外观描述，
          包括光如何与物体表面相互作用等信息，
          以及再辐射\sidenote{译者注：原文reradiated。}（或散射\sidenote{译者注：原文scattered。}）光的性质。
          表面散射模型是典型的参数化模型，
          因此可以模拟各种外观。
    \item \keyindex{间接光传输}{indirect light transport}{light光}\sidenote{译者注：这里把transport译作“传输”是为了
              与下一段propagation译作“传播”区分开，但个人理解似乎就是“传播”的意思。}：因为
          光在一个物体上反射或折射后可能遇到另一个物体，
          所以通常有必要追踪从表面发出的额外光线来捕捉这种效应。
    \item \keyindex{光线传播}{ray propagation}{ray光线}：我们需要知道光在空间中沿光线传播时发生了什么。
          如果渲染真空中的场景，则光能量沿光线保持恒定。
          真正的真空虽然在地球上是罕见的，
          但对许多环境而言是合理的近似。
          更多复杂模型可用于追踪穿过雾、烟、大气等的光线。
\end{itemize}

本节我们将简要讨论以上每个仿真任务。
后续章节我们会展示pbrt底层仿真组件的高级接口，
了解贯穿主渲染循环的单个光线处理过程。
我们还会介绍基于Turner Whitted的
原始光线追踪算法的表面散射模型实现。

\subsection{相机}\label{sub:相机}

几乎每个人都用过\keyindex{相机}{camera}{}，熟悉它的基本功能：
你表达记下世界的一张图像的愿望（通常是按按钮或点击屏幕），
然后图像就被记录到\keyindex{胶片}{film}{}或电子传感器上。
最简单的拍照设备之一称作\keyindex{针孔相机}{pinhole camera}{camera相机}。
针孔相机由一端打有小孔的遮光盒组成（\reffig{1.1}）。
当孔未被遮挡时，光射进孔落到固定在盒子另一端的相纸上。
虽然它很简单，但这种相机至今仍在使用，常用于艺术目的。
要在胶片上获得足够的光以形成图像需要非常长的曝光时间。
\begin{figure}[h]
    \centering\input{Pictures/chap01/PinholeCamera.tex}
    \caption{针孔相机}\label{fig:1.1}
\end{figure}

虽然大多数相机都比针孔相机复杂得多，
但针孔相机是仿真的便捷起点。
相机最重要的功能是定义会被记录到胶片上的场景部分。
在\reffig{1.1}中，我们可以看见从针孔到胶片边的连线
是如何构造出延伸到场景中的双锥体的。
不在该锥体内的物体不会在胶片上成像。
因为实际的相机成像形状比锥体更复杂，
我们把这个可能在胶片上成像的空间区域称为\keyindex{视见体}{viewing volume}{}。

针孔相机也可以看作是把胶片平面放置在针孔的\emph{前方}但距离不变（\reffig{1.2}）。
注意从孔到胶片的连线正好定义了和之前一样的视见体。
当然，这不是真实相机的实际构建方法，
但对于仿真目的而言它是个方便的抽象。
当胶片（或成像）平面在针孔前时，
针孔也常常改称作\keyindex{眼睛}{eye}{}。
\begin{figure}[h]
    \centering\input{Pictures/chap01/Filminfront.tex}
    \caption{当仿真针孔相机时，我们把胶片放在孔前的平面，并把孔改称为\emph{眼睛}。}\label{fig:1.2}
\end{figure}