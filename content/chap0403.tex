\section{包围盒层次}\label{sec:包围盒层次}

\keyindex{包围盒层次}{bounding volume hierarchy}{}(BVH)是一种
基于图元细分的光线相交加速方法，把图元划分为不相交集合的层次
（相反，空间细分一般把空间划分为不相交集合的层次）。
\reffig{4.2}展示了简单场景的包围盒层次\sidenote{译者注：包围盒是边界框的近义词。}。
图元存于\keyindex{叶子}{leaf}{}中，只要它不与节点的边界相交，
该节点下的子树就可以跳过。
\begin{figure}[htbp]
    \centering\input{Pictures/chap04/Primitivesandhierarchy.tex}
    \caption{简单场景的包围盒层次。(a)一小部分图元，边界框用虚线表示。
        图元基于邻近度聚合；这里，球体和等边三角形在被框住整个场景的边界框
        围住之前都被另一个边界框包围了（都用实线表示）。(b)相应的包围盒层次。
        根节点持有整个场景。这里它有两个孩子，一个保存包围了球体和等边三角形的边界框
        （又把这些图元作为其孩子），另一个保存持有瘦三角形的边界框。}
    \label{fig:4.2}
\end{figure}

图元细分的一个性质是每个图元只在层次中出现一次。
相反，一个图元可能与空间细分的多个空间区域重合，
因此在光线穿过它们时要多次测试相交
\footnote{\protect\keyindex{邮箱}{mailboxing}{}技术可用于
    让使用空间细分的加速器避免这样的多次相交，但它的实现在存在多进程时会很棘手。
    “扩展阅读”一节有关于邮箱的更多信息。}。
该性质还意味着表示图元细分层次所需的内存量是有界的。
对于每个叶子中保存单个图元的二叉BVH，节点总数为$2n-1$，其中$n$是图元数量。
有$n$个叶子节点和$n-1$个内部节点。
如果叶子保存了多个图元，则需要的节点更少。

BVH加速器{\initvar{BVHAccel}{}}定义在