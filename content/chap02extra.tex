\section{译者补充：四元数}\label{sec:译者补充：四元数}
\begin{remark}
    本节内容不是原书内容，而是译者自学补充的，请酌情参考和斧正。
\end{remark}

本节内容主要依据文献\citep{10.5555/90767.90913,enwiki:1013104981}整理而成，
给出四元数相关数学推导，具体介绍
四元数的定义、性质及其在几何变换中的运用。

\subsection{四元数的定义}\label{sub:四元数的定义}
\begin{definition}
    \keyindex{四元数}{quaternion}{}记作
    \begin{align}
        {\bm q}=c+x\mathbf{i}+y\mathbf{j}+z\mathbf{k}\, ,
    \end{align}
    其中$c, x, y, z$是实数，
    $\mathbf{i}, \mathbf{j}, \mathbf{k}$是\keyindex{基四元数}{basic quaternion}{quaternion四元数}，
    也称\keyindex{基元}{basis element}{quaternion四元数}。

    基四元数可视为分别指向三个空间轴向的单位向量。
    此时${\bm q}$可以看作由一个标量和一个向量构成：
    其中$c$称为\keyindex{实部}{real part}{}或\keyindex{标量部}{scalar part}{quaternion四元数}，
    $x\mathbf{i}+y\mathbf{j}+z\mathbf{k}$称为\keyindex{虚部}{imaginary part}{quaternion四元数}、\keyindex{纯部}{pure part}{quaternion四元数}或\keyindex{向量部}{vector part}{quaternion四元数}。
\end{definition}
\begin{definition}
    当$c=0$且$xyz\neq 0$时，${\bm q}$称为\keyindex{向量四元数}{vector quaternion}{quaternion四元数}。
\end{definition}
\begin{definition}
    当$x=y=z=0$时，${\bm q}$称为\keyindex{标量四元数}{scalar quaternion}{quaternion四元数}。
    其中，当$c=x=y=z=0$时，${\bm q}$称为\keyindex{零四元数}{zero quaternion}{quaternion四元数}，记作$0$。
\end{definition}
\begin{notation}
    在实际书写时，我们做如下约定：
    \begin{itemize}
        \item $c, x, y, z$之一等于$0$时，略写相应项；
        \item $x, y, z$之一等于$1$时，相应项简写为$\mathbf{i, j}$或$\mathbf{k}$；
        \item 也可写作${\bm q}=c+{\bm u}$，其中$c$为标量，${\bm u}=x\mathbf{i}+y\mathbf{j}+z\mathbf{k}$为向量；
        \item 所有四元数构成的集合记作$\mathbb{H}$。
    \end{itemize}
\end{notation}
\begin{remark}
    因为实数域$\mathbb{R}$、向量空间$\mathbb{R}^3$分别
    与$\mathbb{H}$的子集\keyindex{同构}{isomorphic}{}，
    所以即便在这种记法下
    实数与标量四元数、三维向量与向量四元数记号一样，
    其逻辑也是自洽的。
\end{remark}
\subsection{四元数的运算}\label{sub:四元数的运算}
分别记四元数为
\begin{align}
    {\bm q}   & =c+{\bm u}=c+x\mathbf{i}+y\mathbf{j}+z\mathbf{k}\, ,             \\
    {\bm q}_n & =c_n+{\bm u}_n=c_n+x_n\mathbf{i}+y_n\mathbf{j}+z_n\mathbf{k}\, ,
\end{align}
其中$c, x, y, z, c_n, x_n, y_n, z_n\in\mathbb{R}$，${\bm u}, {\bm u}_n\in\mathbb{R}^3$，$n$为下标。
\begin{definition}
    四元数\keyindex{加法}{addition}{}为
    \begin{align}
        {\bm q}_1+{\bm q}_2 & =(c_1+c_2)+({\bm u}_1+{\bm u}_2)\nonumber                                  \\
                            & =(c_1+c_2)+(x_1+x_2)\mathbf{i}+(y_1+y_2)\mathbf{j}+(z_1+z_2)\mathbf{k}\, .
    \end{align}
\end{definition}
\begin{proposition}
    四元数加法的\keyindex{单位元}{identity element}{}是零四元数。
\end{proposition}
\begin{proposition}
    四元数加法的\keyindex{逆元}{inverse element}{}是
    \begin{align}
        -{\bm q}=-c-x\mathbf{i}-y\mathbf{j}-z\mathbf{k}\, .
    \end{align}
\end{proposition}
\begin{proposition}
    四元数的加法满足\keyindex{交换律}{law of commutation}{}
    \begin{align}
        {\bm q}_1+{\bm q}_2={\bm q}_2+{\bm q}_1, \quad \forall {\bm q}_1, {\bm q}_2\in \mathbb{H}\, .
    \end{align}
\end{proposition}
\begin{proposition}
    四元数的加法满足\keyindex{结合律}{law of association}{}
    \begin{align}
        ({\bm q}_1+{\bm q}_2)+{\bm q}_3={\bm q}_1+({\bm q}_2+{\bm q}_3), \quad \forall {\bm q}_1, {\bm q}_2, {\bm q}_3\in \mathbb{H}\, .
    \end{align}
\end{proposition}
\begin{notation}
    约定向量的\keyindex{数乘}{scalar multiplication}{}、\keyindex{内积}{inner product}{}、\keyindex{叉积}{cross product}{}分别记作
    \begin{align}
        \lambda{\bm u}           & =(\lambda x)\mathbf{i}+(\lambda y)\mathbf{j}+(\lambda z)\mathbf{k},\quad \forall \lambda\in\mathbb{R}\, , \\
        {\bm u}_1\cdot{\bm u}_2  & =x_1x_2+y_1y_2+z_1z_2\, ,                                                                                 \\
        {\bm u}_1\times{\bm u}_2 & =(y_1z_2-y_2z_1)\mathbf{i}+(z_1x_2-z_2x_1)\mathbf{j}+(x_1y_2-x_2y_1)\mathbf{k}\, .
    \end{align}
\end{notation}
\begin{definition}
    四元数${\bm q}$与实数$\lambda$的\keyindex{数乘}{scalar multiplication}{}为
    \begin{align}
        \lambda{\bm q}={\bm q}\lambda & =\lambda c+\lambda {\bm u}\nonumber                                              \\
                                      & =\lambda c+(\lambda x)\mathbf{i}+(\lambda y)\mathbf{j}+(\lambda z)\mathbf{k}\, .
    \end{align}
\end{definition}
\begin{proposition}
    四元数的数乘对加法满足\keyindex{分配律}{law of distribution}{}
    \begin{align}
        (\lambda_1+\lambda_2){\bm q} & =\lambda_1{\bm q}+\lambda_2{\bm q}, \quad \forall \lambda_1, \lambda_2\in\mathbb{R}, \forall {\bm q}\in\mathbb{H}\, , \\
        \lambda({\bm q}_1+{\bm q}_2) & =\lambda{\bm q}_1+\lambda{\bm q}_2, \quad \forall \lambda\in\mathbb{R}, \forall {\bm q}_1, {\bm q}_2\in\mathbb{H}\, .
    \end{align}
\end{proposition}
\begin{definition}
    基元$\mathbf{i}, \mathbf{j}, \mathbf{k}$的乘法为
    \begin{align}
        1\mathbf{i}  & =\mathbf{i}1=\mathbf{i}, & 1\mathbf{j}  & =\mathbf{j}1=\mathbf{j}, & 1\mathbf{k}  & =\mathbf{k}1=\mathbf{k}\, ,\nonumber \\
        \mathbf{i}^2 & =-1,                     & \mathbf{j}^2 & =-1,                     & \mathbf{k}^2 & =-1\, ,                    \nonumber \\
        \mathbf{ij}  & =\mathbf{k},             & \mathbf{jk}  & =\mathbf{i},             & \mathbf{ki}  & =\mathbf{j}\, ,            \nonumber \\
        \mathbf{ji}  & =-\mathbf{k},            & \mathbf{kj}  & =-\mathbf{i},            & \mathbf{ik}  & =-\mathbf{j}\, .
    \end{align}
\end{definition}
\begin{definition}
    四元数\keyindex{乘法}{multiplication}{}为
    \begin{align}
        {\bm q}_1{\bm q}_2 & =(c_1+{\bm u}_1)(c_2+{\bm u}_2)\nonumber                                                                      \\
                           & =(c_1+x_1\mathbf{i}+y_1\mathbf{j}+z_1\mathbf{k})(c_2+x_2\mathbf{i}+y_2\mathbf{j}+z_2\mathbf{k})\nonumber      \\
                           & =\quad c_1c_2+c_1x_2\mathbf{i}+c_1y_2\mathbf{j}+c_1z_2\mathbf{k}\nonumber                                     \\
                           & \quad +x_1c_2\mathbf{i}+x_1x_2\mathbf{i}^2+x_1y_2\mathbf{i}\mathbf{j}+x_1z_2\mathbf{i}\mathbf{k}\nonumber     \\
                           & \quad +y_1c_2\mathbf{j}+y_1x_2\mathbf{j}\mathbf{i}+y_1y_2\mathbf{j}^2+y_1z_2\mathbf{j}\mathbf{k}\nonumber     \\
                           & \quad +z_1c_2\mathbf{k}+z_1x_2\mathbf{k}\mathbf{i}+z_1y_2\mathbf{k}\mathbf{j}+z_1z_2\mathbf{k}^2\nonumber     \\
                           & =\quad c_1c_2-(x_1x_2+y_1y_2+z_1z_2)\nonumber                                                                 \\
                           & \quad +c_1(x_2\mathbf{i}+y_2\mathbf{j}+z_2\mathbf{k})+c_2(x_1\mathbf{i}+y_1\mathbf{j}+z_1\mathbf{k})\nonumber \\
                           & \quad +(y_1z_2-y_2z_1)\mathbf{i}+(z_1x_2-z_2x_1)\mathbf{j}+(x_1y_2-x_2y_1)\mathbf{k}\nonumber                 \\
                           & =(c_1c_2-{\bm u}_1\cdot{\bm u}_2)+(c_1{\bm u}_2+c_2{\bm u}_1+{\bm u}_1\times{\bm u}_2)\, ,
    \end{align}
    也称为\keyindex{哈密顿积}{Hamilton product}{}。
\end{definition}
\begin{proposition}
    四元数乘法的单位元是$1$。
\end{proposition}
\begin{proposition}
    四元数的乘法不满足交换律。
\end{proposition}
\begin{example}
    取
    \begin{align}
        {\bm q}_1 & =1+2\mathbf{i}+3\mathbf{j}+4\mathbf{k}\, , \\
        {\bm q}_2 & =5+6\mathbf{i}+7\mathbf{j}+8\mathbf{k}\, .
    \end{align}
    于是易得
    \begin{align}
        {\bm q}_1{\bm q}_2 & =-60+12\mathbf{i}+30\mathbf{j}+24\mathbf{k}\, , \\
        {\bm q}_2{\bm q}_1 & =-60+20\mathbf{i}+14\mathbf{j}+32\mathbf{k}\, .
    \end{align}
    显然${\bm q}_1{\bm q}_2\neq{\bm q}_2{\bm q}_1$。
\end{example}
\begin{proposition}
    四元数的乘法满足结合律
    \begin{align}
        ({\bm q}_1{\bm q}_2){\bm q}_3={\bm q}_1({\bm q}_2{\bm q}_3), \quad \forall {\bm q}_1, {\bm q}_2, {\bm q}_3\in \mathbb{H}\, .
    \end{align}
\end{proposition}
\begin{prove}
    根据定义有
    \begin{align}
        ({\bm q}_1{\bm q}_2){\bm q}_3 & =((c_1+{\bm u}_1)(c_2+{\bm u}_2))(c_3+{\bm u}_3)\nonumber                                                                                           \\
                                      & =((c_1c_2-{\bm u}_1\cdot{\bm u}_2)+(c_1{\bm u}_2+c_2{\bm u}_1+{\bm u}_1\times{\bm u}_2))(c_3+{\bm u}_3)\nonumber                                    \\
                                      & =\quad ((c_1c_2-{\bm u}_1\cdot{\bm u}_2)c_3-(c_1{\bm u}_2+c_2{\bm u}_1+{\bm u}_1\times{\bm u}_2)\cdot{\bm u}_3)\nonumber                            \\
                                      & \quad +((c_1c_2-{\bm u}_1\cdot{\bm u}_2){\bm u}_3+c_3(c_1{\bm u}_2+c_2{\bm u}_1+{\bm u}_1\times{\bm u}_2)\nonumber                                  \\
                                      & \quad +(c_1{\bm u}_2+c_2{\bm u}_1+{\bm u}_1\times{\bm u}_2)\times{\bm u}_3)\nonumber                                                                \\
                                      & =\quad c_1c_2c_3-c_3{\bm u}_1\cdot{\bm u}_2-c_1{\bm u}_2\cdot{\bm u}_3-c_2{\bm u}_1\cdot{\bm u}_3-({\bm u}_1\times{\bm u}_2)\cdot{\bm u}_3\nonumber \\
                                      & \quad +c_1c_2{\bm u}_3-({\bm u}_1\cdot{\bm u}_2){\bm u}_3+c_3c_1{\bm u}_2+c_2c_3{\bm u}_1+c_3{\bm u}_1\times{\bm u}_2\nonumber                      \\
                                      & \quad +c_1{\bm u}_2\times{\bm u}_3+c_2{\bm u}_1\times{\bm u}_3+({\bm u}_1\times{\bm u}_2)\times{\bm u}_3\nonumber                                   \\
                                      & =\quad  c_1c_2c_3-({\bm u}_1\times{\bm u}_2)\cdot{\bm u}_3+({\bm u}_1\times{\bm u}_2)\times{\bm u}_3-({\bm u}_1\cdot{\bm u}_2){\bm u}_3\nonumber    \\
                                      & \quad +c_2c_3{\bm u}_1+c_1{\bm u}_2\times{\bm u}_3-c_1{\bm u}_2\cdot{\bm u}_3\nonumber                                                              \\
                                      & \quad +c_3c_1{\bm u}_2+c_2{\bm u}_1\times{\bm u}_3-c_2{\bm u}_1\cdot{\bm u}_3\nonumber                                                              \\
                                      & \quad +c_1c_2{\bm u}_3+c_3{\bm u}_1\times{\bm u}_2-c_3{\bm u}_1\cdot{\bm u}_2\, .
    \end{align}
    同理有
    \begin{align}
        {\bm q}_1({\bm q}_2{\bm q}_3) & =(c_1+{\bm u}_1)((c_2+{\bm u}_2)(c_3+{\bm u}_3))\nonumber                                                                                           \\
                                      & =(c_1+{\bm u}_1)((c_2c_3-{\bm u}_2\cdot{\bm u}_3)+(c_2{\bm u}_3+c_3{\bm u}_2+{\bm u}_2\times{\bm u}_3))\nonumber                                    \\
                                      & =\quad(c_1(c_2c_3-{\bm u}_2\cdot{\bm u}_3)-{\bm u}_1\cdot(c_2{\bm u}_3+c_3{\bm u}_2+{\bm u}_2\times{\bm u}_3))\nonumber                             \\
                                      & \quad +(c_1(c_2{\bm u}_3+c_3{\bm u}_2+{\bm u}_2\times{\bm u}_3)+(c_2c_3-{\bm u}_2\cdot{\bm u}_3){\bm u}_1\nonumber                                  \\
                                      & \quad +{\bm u}_1\times(c_2{\bm u}_3+c_3{\bm u}_2+{\bm u}_2\times{\bm u}_3))\nonumber                                                                \\
                                      & =\quad c_1c_2c_3-c_1{\bm u}_2\cdot{\bm u}_3-c_2{\bm u}_1\cdot{\bm u}_3-c_3{\bm u}_1\cdot{\bm u}_2-{\bm u}_1\cdot({\bm u}_2\times{\bm u}_3)\nonumber \\
                                      & \quad +c_1c_2{\bm u}_3+c_1c_3{\bm u}_2+c_1{\bm u}_2\times{\bm u}_3+c_2c_3{\bm u}_1-({\bm u}_2\cdot{\bm u}_3){\bm u}_1\nonumber                      \\
                                      & \quad +c_2{\bm u}_1\times{\bm u}_3+c_3{\bm u}_1\times{\bm u}_2+{\bm u}_1\times({\bm u}_2\times{\bm u}_3)\nonumber                                   \\
                                      & =\quad c_1c_2c_3-{\bm u}_1\cdot({\bm u}_2\times{\bm u}_3)+{\bm u}_1\times({\bm u}_2\times{\bm u}_3)-({\bm u}_2\cdot{\bm u}_3){\bm u}_1\nonumber     \\
                                      & \quad +c_2c_3{\bm u}_1+c_1{\bm u}_2\times{\bm u}_3-c_1{\bm u}_2\cdot{\bm u}_3\nonumber                                                              \\
                                      & \quad +c_3c_1{\bm u}_2+c_2{\bm u}_1\times{\bm u}_3-c_2{\bm u}_1\cdot{\bm u}_3\nonumber                                                              \\
                                      & \quad +c_1c_2{\bm u}_3+c_3{\bm u}_1\times{\bm u}_2-c_3{\bm u}_1\cdot{\bm u}_2\, .
    \end{align}
    注意到向量运算有\sidenote{它们其实是向量的\protect\keyindex{标量三重积}{scalar triple product}{}的两种等价定义，也称\protect\keyindex{混合积}{mixed product}{}。}
    \begin{align}
        ({\bm u}_1\times{\bm u}_2)\cdot{\bm u}_3\equiv{\bm u}_1\cdot({\bm u}_2\times{\bm u}_3)\, ,
    \end{align}
    以及\sidenote{第一个和第三个等号的变换利用了\protect\keyindex{向量三重积}{vector triple product}{}的性质，
        也称为\protect\keyindex{三重积展开}{triple product expansion}{}或\protect\keyindex{拉格朗日公式}{Lagrange's formula}{}。}
    \begin{align}
          & ({\bm u}_1\times{\bm u}_2)\times{\bm u}_3-({\bm u}_1\cdot{\bm u}_2){\bm u}_3\nonumber                             \\
        = & ({\bm u}_1\cdot{\bm u}_3){\bm u}_2-({\bm u}_2\cdot{\bm u}_3){\bm u}_1-({\bm u}_1\cdot{\bm u}_2){\bm u}_3\nonumber \\
        = & ({\bm u}_1\cdot{\bm u}_3){\bm u}_2-({\bm u}_1\cdot{\bm u}_2){\bm u}_3-({\bm u}_2\cdot{\bm u}_3){\bm u}_1\nonumber \\
        = & ({\bm u}_3\times{\bm u}_2)\times{\bm u}_1-({\bm u}_2\cdot{\bm u}_3){\bm u}_1\nonumber                             \\
        = & {\bm u}_1\times(-{\bm u}_3\times{\bm u}_2)-({\bm u}_2\cdot{\bm u}_3){\bm u}_1\nonumber                            \\
        = & {\bm u}_1\times({\bm u}_2\times{\bm u}_3)-({\bm u}_2\cdot{\bm u}_3){\bm u}_1\, .
    \end{align}
    所以$({\bm q}_1{\bm q}_2){\bm q}_3={\bm q}_1({\bm q}_2{\bm q}_3)$成立。
\end{prove}
\begin{proposition}
    四元数的乘法对加法满足分配律
    \begin{align}
        {\bm q}_1({\bm q}_2+{\bm q}_3)={\bm q}_1{\bm q}_2+{\bm q}_1{\bm q}_3, \quad \forall {\bm q}_1, {\bm q}_2, {\bm q}_3\in \mathbb{H}\, , \\
        ({\bm q}_1+{\bm q}_2){\bm q}_3={\bm q}_1{\bm q}_3+{\bm q}_2{\bm q}_3, \quad \forall {\bm q}_1, {\bm q}_2, {\bm q}_3\in \mathbb{H}\, .
    \end{align}
\end{proposition}
\begin{prove}
    根据定义有
    \begin{align}
        {\bm q}_1({\bm q}_2+{\bm q}_3) & =(c_1+{\bm u}_1)((c_2+{\bm u}_2)+(c_3+{\bm u}_3))\nonumber                                            \\
                                       & =(c_1+{\bm u}_1)((c_2+c_3)+({\bm u}_2+{\bm u}_3))\nonumber                                            \\
                                       & =\quad (c_1(c_2+c_3)-{\bm u}_1\cdot({\bm u}_2+{\bm u}_3))\nonumber                                    \\
                                       & \quad +(c_1({\bm u}_2+{\bm u}_3)+(c_2+c_3){\bm u}_1+{\bm u}_1\times({\bm u}_2+{\bm u}_3))\nonumber    \\
                                       & =\quad (c_1c_2-{\bm u}_1\cdot{\bm u}_2)+(c_1{\bm u}_2+c_2{\bm u}_1+{\bm u}_1\times{\bm u}_2)\nonumber \\
                                       & \quad +(c_1c_3-{\bm u}_1\cdot{\bm u}_3)+(c_1{\bm u}_3+c_3{\bm u}_1{\bm u}_1\times{\bm u}_3)\nonumber  \\
                                       & ={\bm q}_1{\bm q}_2+{\bm q}_1{\bm q}_3\, .
    \end{align}
    \begin{align}
        ({\bm q}_1+{\bm q}_2){\bm q}_3 & =((c_1+{\bm u}_1)+(c_2+{\bm u}_2))(c_3+{\bm u}_3)\nonumber                                            \\
                                       & =((c_1+c_2)+({\bm u}_1+{\bm u}_2))(c_3+{\bm u}_3)\nonumber                                            \\
                                       & =\quad ((c_1+c_2)c_3-({\bm u}_1+{\bm u}_2)\cdot{\bm u}_3)\nonumber                                    \\
                                       & \quad +((c_1+c_2){\bm u}_3+c_3({\bm u}_1+{\bm u}_2)+({\bm u}_1+{\bm u}_2)\times{\bm u}_3)\nonumber    \\
                                       & =\quad (c_1c_3-{\bm u}_1\cdot{\bm u}_3)+(c_1{\bm u}_3+c_3{\bm u}_1+{\bm u}_1\times{\bm u}_3)\nonumber \\
                                       & \quad +(c_2c_3-{\bm u}_2\cdot{\bm u}_3)+(c_2{\bm u}_3+c_3{\bm u}_2+{\bm u}_2\times{\bm u}_3)\nonumber \\
                                       & ={\bm q}_1{\bm q}_3+{\bm q}_2{\bm q}_3\, .
    \end{align}
\end{prove}
\begin{definition}
    称四元数${\bm q}=c+{\bm u}$与$\bar{\bm q}=c-{\bm u}$互为\keyindex{共轭}{conjugate}{}。
\end{definition}
\begin{proposition}
    四元数积的共轭等于逆序共轭的积，即
    \begin{align}
        \overline{{\bm q}_1{\bm q}_2}=\bar{\bm q}_2\bar{\bm q}_1, \quad\forall {\bm q}_1, {\bm q}_2\in\mathbb{H}\, .
    \end{align}
\end{proposition}
\begin{prove}
    根据定义有
    \begin{align}
        \overline{{\bm q}_1{\bm q}_2} & =(c_1c_2-{\bm u}_1\cdot{\bm u}_2)-(c_1{\bm u}_2+c_2{\bm u}_1+{\bm u}_1\times{\bm u}_2)\nonumber                   \\
                                      & =(c_2c_1-(-{\bm u}_2)\cdot(-{\bm u}_1))+(c_2(-{\bm u}_1)+c_1(-{\bm u}_2)+(-{\bm u}_2)\times(-{\bm u}_1))\nonumber \\
                                      & =(c_2-{\bm u}_2)(c_1-{\bm u}_1)\nonumber                                                                          \\
                                      & =\bar{\bm q}_2\bar{\bm q}_1\, .
    \end{align}
\end{prove}
\begin{definition}
    四元数的\keyindex{模}{magnitude}{}为
    \begin{align}
        \|{\bm q}\|=\sqrt{{\bm q}\bar{\bm q}}=\sqrt{\bar{\bm q}{\bm q}}=\sqrt{c^2+x^2+y^2+z^2}\, .
    \end{align}
\end{definition}
\begin{definition}
    模为$1$的四元数${\bm q}$称为\keyindex{单位四元数}{unit quaternion}{quaternion四元数}。
\end{definition}
\begin{definition}
    称$、\displaystyle\frac{1}{\|{\bm q}\|}{\bm q}$为非零四元数${\bm q}$的\keyindex{规范化四元数}{versor}{quaternion四元数}。
\end{definition}
\begin{proposition}
    当向量四元数${\bm q}$是单位四元数即$c=0$且$x^2+y^2+z^2=1$时，有
    \begin{align}
        {\bm q}^2={\bm q}{\bm q}=-1\, .
    \end{align}
\end{proposition}
\begin{prove}
    依据哈密顿积定义有
    \begin{align}
        {\bm q}^2={\bm q}{\bm q} & =(c^2-{\bm u}\cdot{\bm u})+(2c{\bm u}+{\bm u}\times{\bm u})\nonumber \\
                                 & =-{\bm u}\cdot{\bm u}\nonumber                                       \\
                                 & =-(x^2+y^2+z^2)\nonumber                                             \\
                                 & =-1\, .
    \end{align}
\end{prove}
\begin{proposition}
    四元数取共轭后模不变，即
    \begin{align}
        \|\bar{\bm q}\|=\|{\bm q}\|\, .
    \end{align}
\end{proposition}
\begin{proposition}
    在四元数的数乘中有
    \begin{align}
        \|\lambda{\bm q}\|=|\lambda|\|{\bm q}\|, \quad \forall \lambda\in\mathbb{R}, \forall {\bm q}\in\mathbb{H}\, .
    \end{align}
\end{proposition}
\begin{proposition}
    在四元数的乘法中有
    \begin{align}
        \|{\bm q}_1{\bm q}_2\|=\|{\bm q}_1\|\|{\bm q}_2\|,\quad \forall {\bm q}_1{\bm q}_2\in\mathbb{H}\, .
    \end{align}
\end{proposition}
\begin{prove}
    根据定义可得
    \begin{align}
        \|{\bm q}_1{\bm q}_2\|^2 = & \|(c_1c_2-x_1x_2-y_1y_2-z_1z_2)\nonumber                    \\
                                   & +(c_1x_2+c_2x_1+y_1z_2-y_2z_1)\mathbf{i}\nonumber           \\
                                   & +(c_1y_2+c_2y_1+z_1x_2-z_2x_1)\mathbf{j}\nonumber           \\
                                   & +(c_1z_2+c_2z_1+x_1y_2-x_2y_1)\mathbf{k}\|^2\nonumber       \\
        =                          & (c_1c_2-x_1x_2-y_1y_2-z_1z_2)^2\nonumber                    \\
                                   & +(c_1x_2+c_2x_1+y_1z_2-y_2z_1)^2\nonumber                   \\
                                   & +(c_1y_2+c_2y_1+z_1x_2-z_2x_1)^2\nonumber                   \\
                                   & +(c_1z_2+c_2z_1+x_1y_2-x_2y_1)^2\nonumber                   \\
        =                          & (c_1^2+x_1^2+y_1^2+z_1^2)(c_2^2+x_2^2+y_2^2+z_2^2)\nonumber \\
        =                          & \|{\bm q}_1\|^2\|{\bm q}_2\|^2\, ,
    \end{align}
    所以$\|{\bm q}_1{\bm q}_2\|=\|{\bm q}_1\|\|{\bm q}_2\|$。
\end{prove}

\begin{proposition}
    四元数${\bm q}$与其共轭的积恒有
    \begin{align}
        {\bm q}\bar{\bm q}=\bar{\bm q}{\bm q}=\|{\bm q}\|^2\, .
    \end{align}
\end{proposition}
\begin{prove}
    根据定义有
    \begin{align}
        {\bm q}\bar{\bm q} & =(c+{\bm u})(c-{\bm u})\nonumber                                                      \\
                           & =(c^2-{\bm u}\cdot(-{\bm u}))+(c(-{\bm u})+c{\bm u}+{\bm u}\times(-{\bm u}))\nonumber \\
                           & =c^2+{\bm u}\cdot{\bm u}\nonumber                                                     \\
                           & =\|{\bm q}\|^2\, .
    \end{align}
    同理有$\bar{\bm q}{\bm q}=\|{\bm q}\|^2$。
\end{prove}
\begin{definition}
    非零四元数${\bm q}$的\keyindex{逆}{inverse}{}是
    \begin{align}
        {\bm q}^{-1}=\frac{1}{\|{\bm q}\|^2}\bar{\bm q}\, .
    \end{align}
    它是哈密顿积的逆元。
\end{definition}
\begin{corollary}
    对于非零四元数${\bm q}$有
    \begin{align}
        {\bm q}{\bm q}^{-1}={\bm q}^{-1}{\bm q}=1\, .
    \end{align}
\end{corollary}
\begin{corollary}
    单位四元数的逆与共轭相等，即
    \begin{align}
        \|{\bm q}\|=1 \Rightarrow {\bm q}^{-1}=\bar{\bm q}\, .
    \end{align}
\end{corollary}

\subsection{四元数与旋转变换}\label{sub:四元数与旋转变换}
如\reffig{2.ex1}所示，点$P$绕单位向量$\bm n$给定的轴顺时针旋转角度$\theta$得到点$P'$。
我们现在说明该一般旋转变换和四元数运算的关系。
\begin{figure}[htbp]
    \centering\input{Pictures/chap02/QuaternionAndRotaion.tex}
    \caption{旋转的几何表达。}
    \label{fig:2.ex1}
\end{figure}

作点$P$在$\bm n$所在直线（过点$O$）上的投影$H$，即$PH\perp OH$。
点$P$绕$\bm n$顺时针旋转角度$\theta$得到点$P'$，即$\angle PHP'=\theta$且$HP'\perp OH$。
最后，作点$P$绕$\bm n$顺时针旋转角度$\displaystyle\frac{\pi}{2}$得到的点$V$，即$HV\perp HP$且$HV\perp OH$。
记向量
\begin{align}
    \bm h=\overrightarrow{OH},\quad
    \bm p=\overrightarrow{OP},\quad
    \bm p'=\overrightarrow{OP'},\quad
    \bm u=\overrightarrow{HP},\quad
    \bm u'=\overrightarrow{HP'},\quad
    \bm v=\overrightarrow{HV}\, .
\end{align}
注意到$\bm n$是单位向量，根据上述几何关系，易得
\begin{align}
    \bm h  & =(\bm n\cdot\bm p)\bm n\, ,          \\
    \bm u  & =\bm p-\bm h\, ,                     \\
    \bm v  & =\bm n\times\bm u\, ,                \\
    \bm u' & =\bm u\cos\theta+\bm v\sin\theta\, , \\
    \bm p' & =\bm h+\bm u'\, .
\end{align}
将这些式子从前往后依次代入可得\sidenote{注意这是普通的向量运算。}
\begin{align}
    \bm p' & =(\bm n\cdot\bm p)\bm n+(\bm p-(\bm n\cdot\bm p)\bm n)\cos\theta+\bm n\times(\bm p-(\bm n\cdot\bm p)\bm n)\sin\theta\nonumber \\
           & =\bm p\cos\theta+(1-\cos\theta)(\bm n\cdot\bm p)\bm n+\bm n\times\bm p\sin\theta\, .
\end{align}
另一方面，我们构造三个四元数$\bm a,\bm a'$和$\bm q$：
\begin{align}
    \bm a  & =\bm p\, ,                                                  \\
    \bm a' & =\bm p'\, ,                                                 \\
    \bm q  & =c+\bm s=\cos\frac{\theta}{2}+\bm n\sin\frac{\theta}{2}\, .
\end{align}
其中$\displaystyle c=\cos\frac{\theta}{2}$，$\displaystyle \bm s=\bm n\sin\frac{\theta}{2}$。于是有\sidenote{注意这是四元数运算。}
\begin{align}
    \bm q\bm a\bar{\bm q} & =(c+\bm s)\bm p(c-\bm s)\nonumber                                                                                                                                                                \\
                          & =(-\bm s\cdot\bm p+(c\bm p+\bm s\times\bm p))(c-\bm s)\nonumber                                                                                                                                  \\
                          & =(-c\bm s\cdot\bm p+(c\bm p+\bm s\times\bm p)\cdot\bm s)+((\bm s\cdot\bm p)\bm s+c(c\bm p+\bm s\times\bm p)-(c\bm p+\bm s\times\bm p)\times\bm s)\nonumber                                       \\
                          & =(\bm s\cdot\bm p)\bm s+c(c\bm p+\bm s\times\bm p)-(c\bm p+\bm s\times\bm p)\times\bm s\nonumber                                                                                                 \\
                          & =(\bm s\cdot\bm p)\bm s+c^2\bm p+c\bm s\times\bm p-c\bm p\times\bm s-\bm s\times\bm p\times\bm s\nonumber                                                                                        \\
                          & =(\bm s\cdot\bm p)\bm s+c^2\bm p+2c\bm s\times\bm p-((\bm s\cdot\bm s)\bm p-(\bm p\cdot\bm s)\bm s)\nonumber                                                                                     \\
                          & =(c^2-\bm s\cdot\bm s)\bm p+2(\bm s\cdot\bm p)\bm s+2c\bm s\times\bm p\nonumber                                                                                                                  \\
                          & =\left(\cos^2\frac{\theta}{2}-\bm n\cdot\bm n\sin^2\frac{\theta}{2}\right)\bm p+2(\bm n\cdot\bm p)\bm n\sin^2\frac{\theta}{2}+2\bm n\times\bm p\cos\frac{\theta}{2}\sin\frac{\theta}{2}\nonumber \\
                          & =\bm p\cos\theta+(1-\cos\theta)(\bm n\cdot\bm p)\bm n+\bm n\times\bm p\sin\theta\nonumber                                                                                                        \\
                          & =\bm a'\, .
\end{align}
其中前三个等号运用了四元数乘法计算规则，
第四个等号算得实部为零，
第六个等号再次运用了向量三重积的性质，
第九个等号运用了三角函数倍角公式。

上式给出了旋转变换与四元数的关系是：
\begin{proposition}
    向量$\bm v$绕任意单位向量$\bm n$顺时针旋转角度$\theta$得到新向量$\bm v'$，
    则$\bm v'$是四元数积$\bm q\bm v\bar{\bm q}$的虚部，其中
    \begin{align}
        \bm q=\cos\frac{\theta}{2}+\bm n\sin\frac{\theta}{2}\, .
    \end{align}

    对应的$3\times3$旋转矩阵$\bm R_{\bm n}(\theta)$为\sidenote{你可以动手验算一下。}
    \begin{align}
        \bm R_{\bm n}(\theta)=\bm I\cos\theta+(1-\cos\theta)\bm n\bm n^\mathrm{T}+\bm A_{\bm n}\sin\theta\, .
    \end{align}
    其中$\bm I$为单位矩阵，$\bm A_{\bm n}$为
    \begin{align}
        \bm A_{\bm n}=\left[
            \begin{array}{ccc}
                0    & -n_z & n_y  \\
                n_z  & 0    & -n_x \\
                -n_y & n_x  & 0
            \end{array}
            \right]\, .
    \end{align}

    对应的$4\times4$旋转矩阵只需在$\bm R_{\bm n}(\theta)$右边和底部添加全零列（行）即可。
\end{proposition}