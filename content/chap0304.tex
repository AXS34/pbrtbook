\section{圆盘}\label{sec:圆盘}

\keyindex{圆盘}{disk}{}是一种有趣的二次曲面，
因为它有特别简单的相交例程避免求解二次方程。
pbrt中，\refvar{Disk}{}是半径为$r$沿$z$轴高度为$h$的圆盘。
它的实现在文件\href{https://github.com/mmp/pbrt-v3/tree/master/src/shapes/disk.h}{\ttfamily shapes/disk.h}和
\href{https://github.com/mmp/pbrt-v3/tree/master/src/shapes/disk.cpp}{\ttfamily shapes/disk.cpp}中。
\begin{lstlisting}
`\initcode{Disk Declarations}{=}`
class `\initvar{Disk}{}` : public `\refvar{Shape}{}` {
public:
    `\refcode{Disk Public Methods}{}`
private:
    `\refcode{Disk Private Data}{}`
};
\end{lstlisting}

为了描述部分圆盘，用户可指定最大$\varphi$值，
超出的圆盘部分被截去（\reffig{3.8}）。
圆盘还能通过指定内径$r_{\mathrm{i}}$推广为\keyindex{圆环}{annulus}{}。
参数形式下，它描述为：
\begin{align*}
    \varphi & =u\varphi_{\max}\, ,                     \\
    x       & =((1-v)r+vr_{\mathrm{i}})\cos\varphi\, , \\
    y       & =((1-v)r+vr_{\mathrm{i}})\sin\varphi\, , \\
    z       & =h\, .
\end{align*}
\begin{figure}[htbp]
    \centering\input{Pictures/chap03/Disksetting.tex}
    \caption{圆盘形状基本设置。圆盘半径为$r$，沿$z$轴高度为$h$。
        通过指定最大$\varphi$值和内径$r_{\mathrm{i}}$可扫掠出部分圆盘。}
    \label{fig:3.8}
\end{figure}

\reffig{3.9}是两个圆盘的渲染图像。
\begin{figure}[htbp]
    \centering\includegraphics[width=\linewidth]{chap03/twodisks.png}
    \caption{两个圆盘。左边是完整圆盘，右边是部分圆盘。}
    \label{fig:3.9}
\end{figure}
\begin{lstlisting}
`\initcode{Disk Public Methods}{=}`
`\refvar{Disk}{}`(const `\refvar{Transform}{}` *ObjectToWorld, const `\refvar{Transform}{}` *WorldToObject,
     bool reverseOrientation, `\refvar{Float}{}` height, `\refvar{Float}{}` radius,
     `\refvar{Float}{}` innerRadius, `\refvar{Float}{}` phiMax)
    : `\refvar{Shape}{}`(ObjectToWorld, WorldToObject, reverseOrientation),
      `\refvar[Disk::height]{height}{}`(height), `\refvar[Disk::radius]{radius}{}`(radius), `\refvar[Disk::innerRadius]{innerRadius}{}`(innerRadius),
      `\refvar[Disk::phiMax]{phiMax}{}`(`\refvar{Radians}{}`(`\refvar{Clamp}{}`(phiMax, 0, 360))) { }
\end{lstlisting}
\begin{lstlisting}
`\initcode{Disk Private Data}{=}`
const `\refvar{Float}{}` `\initvar[Disk::height]{height}{}`, `\initvar[Disk::radius]{radius}{}`, `\initvar[Disk::innerRadius]{innerRadius}{}`, `\initvar[Disk::phiMax]{phiMax}{}`;
\end{lstlisting}